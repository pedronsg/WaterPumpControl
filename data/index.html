<!DOCTYPE html><html lang="en">  <head>    <title>PumpControl Admin</title>     <title>Water Pump Control</title>    <link href="/bootstrap.css" rel="stylesheet">    <link href="/jumbotron-narrow.css" rel="stylesheet">	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">	<link rel="manifest" href="/site.webmanifest">	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">	<meta name="msapplication-TileColor" content="#da532c">	<meta name="theme-color" content="#ffffff">	<script src="/Chart.bundle.js"></script>	<script src="/utils.js"></script>	<style>		canvas {		-moz-user-select: none;		-webkit-user-select: none;		-ms-user-select: none;	}    </style>	    <script>var PUMPSTATUS = {  OFF : {value: 0, description: "Off"},   ON: {value: 1, description: "On"},   NOWATER : {value: 2, description: "No water"},  OVERLOAD : {value: 3, description: "Overload"},  FLOODPROTECTION : {value: 4, description: "Flood Protection"}};var INTERVAL=1000;	document.addEventListener('DOMContentLoaded', function() {			getPumpStatus();			setInterval(getPumpStatus, INTERVAL);	}, false);	var maxItems=30;	var amps = [];	var bars = [];	var maxBars = [];	var minBars = [];	var chartLabel = [];			function startStop(){			var obj = new Object();		obj.startStop= (document.getElementById("btnStartStop").value == "Start Pump");		var jsonString= JSON.stringify(obj);		var xmlHttp = new XMLHttpRequest();		xmlHttp.open("POST", "/setStatus",true); 		xmlHttp.setRequestHeader("Content-Type", "application/json");		xmlHttp.onreadystatechange = function()		{			if(xmlHttp.readyState == 4 && xmlHttp.status == 200)			{			/*	var stObj = JSON.parse(xmlHttp.responseText);				if(stObj.startStop)				{					document.getElementById("btnStartStop").value = "Stop Pump";					pumpStatus.innerText = "Pump Status: ON";				}				else				{					document.getElementById("btnStartStop").value = "Start Pump";					pumpStatus.innerText = "Pump Status: OFF";				}*/			}		};		xmlHttp.send(jsonString); 			};	function getPumpStatus(){			var obj = new Object();				if(maxItems==amps.length)		{			obj.numberOfItems=1;		}else{			obj.numberOfItems=maxItems-amps.length;		}		var jsonString= JSON.stringify(obj);		var xmlhttp = new XMLHttpRequest();		xmlhttp.open("POST", "/getPumpStatus",true); 		xmlhttp.setRequestHeader("Content-Type", "application/json");		xmlhttp.onreadystatechange = function() {			if (xmlhttp.readyState == XMLHttpRequest.DONE) {   // XMLHttpRequest.DONE == 4			   if (xmlhttp.status == 200) {					var jsonObj = JSON.parse(xmlhttp.responseText);									switch(jsonObj.pumpStatus)					{						case PUMPSTATUS.OFF.value:							pumpStatusLabel.innerText = "Pump Status: " + PUMPSTATUS.OFF.description;							document.getElementById("btnStartStop").value = "Start Pump";							document.getElementById("btnStartStop").disabled = false;							//description=PUMPSTATUS.OFF.description;						break;						case PUMPSTATUS.ON.value:							pumpStatusLabel.innerText = "Pump Status: " + PUMPSTATUS.ON.description;							document.getElementById("btnStartStop").value = "Stop Pump";										document.getElementById("btnStartStop").disabled = false;							//description=PUMPSTATUS.ON.description;						break;							case PUMPSTATUS.NOWATER.value:							pumpStatusLabel.innerText = "Pump Status: " + PUMPSTATUS.NOWATER.description;							document.getElementById("btnStartStop").value = "Start Pump";							//document.getElementById("btnStartStop").disabled = false;						break;							case PUMPSTATUS.OVERLOAD.value:							pumpStatusLabel.innerText = "Pump Status: " + PUMPSTATUS.OVERLOAD.description;							document.getElementById("btnStartStop").value = "Start Pump";							document.getElementById("btnStartStop").disabled = false;							//description=PUMPSTATUS.OVERLOAD.description;						break;								case PUMPSTATUS.FLOODPROTECTION.value:							pumpStatusLabel.innerText = "Pump Status: " + PUMPSTATUS.FLOODPROTECTION.description;							document.getElementById("btnStartStop").value = "Start Pump";							document.getElementById("btnStartStop").disabled = false;							//description=PUMPSTATUS.FLOODPROTECTION.description;						break;												default:											}					if (amps.length<maxItems)					{						for (i in jsonObj.values) {							amps.push(jsonObj.values[i].amps);							bars.push(jsonObj.values[i].bars);							maxBars.push(jsonObj.values[i].maxBars);							minBars.push(jsonObj.values[i].minBars);							chartLabel.push("");						}					}else					{						amps.shift();						amps.push(jsonObj.values[0].amps);						bars.shift();						bars.push(jsonObj.values[0].bars);						maxBars.shift();						maxBars.push(jsonObj.values[0].maxBars);						minBars.shift();						minBars.push(jsonObj.values[0].minBars);						chartLabel.shift();						chartLabel.push("");					}									var lineChartData = {					labels: chartLabel,					datasets: [{						label: 'Current (amps)',						borderColor: window.chartColors.green,						backgroundColor: window.chartColors.green,						fill: false,						data: amps,						yAxisID: 'y-axis-1',					}, {						label: 'Pressure (bars)',						borderColor: window.chartColors.blue,						backgroundColor: window.chartColors.blue,						fill: false,						data: bars,						yAxisID: 'y-axis-1'					}, {						label: 'Max (bars)',						borderColor: window.chartColors.red,						backgroundColor: window.chartColors.red,						fill: false,						data: maxBars,						yAxisID: 'y-axis-1',						pointRadius:0					}, {						label: 'Min (bars)',						borderColor: window.chartColors.yellow,						backgroundColor: window.chartColors.yellow,						fill: false,						data: minBars,						yAxisID: 'y-axis-1',						pointRadius:0					}					]					};				   					drawGraph(lineChartData);				}			}		};		xmlhttp.send(jsonString);		//xmlhttp.send();	};			function drawGraph(lineChartData) {			var ctx = document.getElementById('canvas').getContext('2d');			window.myLine = Chart.Line(ctx, {				data: lineChartData,				options: {					responsive: true,					hoverMode: 'index',					stacked: false,					title: {						display: true,						text: 'Live Chart'					},					scales: {						yAxes: [{							type: 'linear',							display: true,							position: 'left',							id: 'y-axis-1',						}]					},					animation: {						duration: 0					}				}			});		}			</script>	      </head>   <body>    <div class="container">      <div class="header">            <nav>                <ul class="nav nav-pills pull-right">                    <li role="presentation" class="active"><a href="live">Live</a>					</li>                    <li role="presentation"><a href="network">Network</a>                    </li>                    <li role="presentation" ><a href="settings">Settings</a>					</li>					<li role="presentation"><a href="admin">Admin</a>                    </li>					</li>					<li role="presentation" ><a href="logout">Logout</a>                    </li>                </ul>            </nav>            <h3 class="text-muted">PumpControl</h3>			<div class="container text-center">				<h4 class="text-muted" id="pumpStatusLabel"></h4>			</div>        </div>       <div style="width:100%;">		<canvas id="canvas"></canvas>	</div>		<legend></legend>		 <input id="btnStartStop" name="singlebutton" class="btn btn-primary btn-block" type="button" onclick="startStop()" value="Stop Pump" />      <footer class="footer">        <p>&copy; PumpControl @2019 by <a href="mailto:pedronsg@gmail.com">pedronsg@gmail.com</a></p>       </footer>     </div>  </body></html>